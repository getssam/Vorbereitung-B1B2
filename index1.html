<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prüfung B1 - German Quiz Master</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
  <div class="reactive-bg"></div>

  <!-- Navbar -->
  <nav class="navbar fade-in">
    <a href="home.html" class="logo">
      <i class="fas fa-earth-europe" style="color: var(--primary-color); margin-right: 10px;"></i>
      Vorbereitung
    </a>
    <div class="menu-container">
      <div class="nav-segment">
        <button id="menuTrigger" class="btn" style="padding: 8px 14px;"><i class="fas fa-bars"></i></button>
      </div>
      <div id="menuCard" class="menu-card fade-in" style="animation-delay: 0.05s;"></div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="dashboard-container fade-in" style="animation-delay: 0.2s;">
    <div class="hero">
      <a href="home.html" class="back"><i class="fas fa-arrow-left"></i> Zurück</a>
      <div class="title">Prüfung B1</div>
      <div class="subtitle">Quiz Practice</div>
      <div class="hero-search">
        <input id="heroSearchB1" class="search-input" type="text" placeholder="Suchen..."/>
      </div>
    </div>
    <div class="tabs">
      <div class="tab active" data-target="tab-b1-lesen">Lesen</div>
      <div class="tab" data-target="tab-b1-gram">Sprachbausteine</div>
      <div class="tab" data-target="tab-b1-hoeren">Hören</div>
      <div class="tab" data-target="tab-b1-schreiben">Schreiben</div>
    </div>
    <div id="tab-b1-lesen" class="tab-content active">
    <div class="sub-tabs">
      <div class="sub-tab active" data-target="lesen-b1-part1">Part 1</div>
      <div class="sub-tab" data-target="lesen-b1-part2">Part 2</div>
      <div class="sub-tab" data-target="lesen-b1-part3">Part 3</div>
    </div>

    <!-- Lesen Teil 1 -->
    <div class="section-card sub-content active" id="lesen-b1-part1">
      <div class="section-title">
        <i class="fas fa-book-open" style="color: var(--primary-color);"></i>
        Lesen Teil 1
      </div>
      <div class="quiz-grid">
        <a class="quiz-btn" href="/quiz/204.html">PETRA/JENNIFER</a>
        <a class="quiz-btn" href="/quiz/206.html">EVA/IRIS</a>
        <a class="quiz-btn" href="/quiz/215.html">SOPHIE/ANDREAS2</a>
        <a class="quiz-btn" href="/quiz/219.html">NADJA/CLAUDIA</a>
        <a class="quiz-btn" href="/quiz/221.html">NICOLE</a>
        <a class="quiz-btn" href="/quiz/223.html">ANDREAS</a>
        <a class="quiz-btn" href="/quiz/226.html">ANNIKA1</a>
        <a class="quiz-btn" href="/quiz/227.html">ANNIKA2/SONJA<br>CORINA</a>
        <a class="quiz-btn" href="/quiz/228.html">CAROLINA/ALICIA</a>
        <a class="quiz-btn" href="/quiz/230.html">VERA</a>
        <a class="quiz-btn" href="/quiz/232.html">THOMAS</a>
        <a class="quiz-btn" href="/quiz/234.html">TAMARA/JAKOB<br>PAUL</a>
        <a class="quiz-btn" href="/quiz/235.html">JAN</a>
        <a class="quiz-btn" href="/quiz/237.html">VIKTOR</a>
        <a class="quiz-btn" href="/quiz/240.html">ALEX & CORA</a>
        <a class="quiz-btn" href="/quiz/242.html">RITA</a>
        <a class="quiz-btn" href="/quiz/244.html">MIROSLAV</a>
        <a class="quiz-btn" href="/quiz/246.html">KARLA</a>
        <a class="quiz-btn" href="/quiz/247.html">MORITZ</a>
      </div>
    </div>

    <!-- Lesen Teil 2 -->
    <div class="section-card sub-content" id="lesen-b1-part2">
      <div class="section-title">
        <i class="fas fa-book-reader" style="color: var(--secondary-color);"></i>
        Lesen Teil 2
      </div>
      <div class="quiz-grid">
        <a class="quiz-btn" href="/quiz/205.html">Petra & ALICIA</a>
        <a class="quiz-btn" href="/quiz/207.html">EVA1</a>
        <a class="quiz-btn" href="/quiz/208.html">IRIS</a>
        <a class="quiz-btn" href="/quiz/216.html">SOPHIE</a>
        <a class="quiz-btn" href="/quiz/220.html">NADJA & CLAUDIA</a>
        <a class="quiz-btn" href="/quiz/222.html">NICOLE</a>
        <a class="quiz-btn" href="/quiz/224.html">ANDREAS</a>
        <a class="quiz-btn" href="/quiz/225.html">ANDREAS2 & CORINA<br>ANNIKA(1&2)</a>
        <a class="quiz-btn" href="/quiz/229.html">CAROLINA/VERA</a>
        <a class="quiz-btn" href="/quiz/231.html">JENNIFER & TAMARA<br>JAKOB/PAUL</a>
        <a class="quiz-btn" href="/quiz/233.html">THOMAS</a>
        <a class="quiz-btn" href="/quiz/236.html">JAN</a>
        <a class="quiz-btn" href="/quiz/238.html">VIKTOR</a>
        <a class="quiz-btn" href="/quiz/239.html">SONJA</a>
        <a class="quiz-btn" href="/quiz/241.html">ALEX & CORA</a>
        <a class="quiz-btn" href="/quiz/243.html">RITA</a>
        <a class="quiz-btn" href="/quiz/245.html">MIROSLAV & KARLA</a>
        <a class="quiz-btn" href="/quiz/248.html">MORITZ</a>
        <a class="quiz-btn" href="/quiz/249.html">MARA</a>
      </div>
    </div>

    <!-- Lesen Teil 3 -->
    <div class="section-card sub-content" id="lesen-b1-part3">
      <div class="section-title">
        <i class="fas fa-newspaper" style="color: var(--primary-color);"></i>
        Lesen Teil 3
      </div>
      <div class="quiz-grid">
        <a class="quiz-btn" href="/quiz/201.html">Petra</a>
        <a class="quiz-btn" href="/quiz/203.html">EVA1</a>
        <a class="quiz-btn" href="/quiz/202.html">IRIS</a>
        <a class="quiz-btn" href="/quiz/217.html">SOPHIE</a>
        <a class="quiz-btn" href="/quiz/218.html">NADJA & CLAUDIA</a>
        <a class="quiz-btn" href="/quiz/286.html">ANDREAS1</a>
        <a class="quiz-btn" href="/quiz/287.html">ANDREAS2</a>
        <a class="quiz-btn" href="/quiz/288.html">CAROLINA</a>
      </div>
    </div>
    </div>

    <!-- Sprachbausteine Teil 1 -->
    <div id="tab-b1-gram" class="tab-content">
    <div class="section-card">
      <div class="section-title">
        <i class="fas fa-puzzle-piece" style="color: var(--secondary-color);"></i>
        Sprachbausteine Teil 1
      </div>
      <div class="quiz-grid">
        <a class="quiz-btn" href="/quiz/209.html">PETRA/NADJA2<br>CLAUDIA</a>
        <a class="quiz-btn" href="/quiz/211.html">EVA</a>
        <a class="quiz-btn" href="/quiz/213.html">IRIS</a>
        <a class="quiz-btn" href="/quiz/250.html">SOPHIE</a>
        <a class="quiz-btn" href="/quiz/251.html">NICOLE</a>
        <a class="quiz-btn" href="/quiz/254.html">ANDREAS</a>
        <a class="quiz-btn" href="/quiz/257.html">ANDREAS2/VIKTOR<br>SONJA</a>
        <a class="quiz-btn" href="/quiz/259.html">ANNIKA1</a>
        <a class="quiz-btn" href="/quiz/261.html">ANNIKA2/JAN<br>CORINA</a>
        <a class="quiz-btn" href="/quiz/262.html">CAROLINA/RITA</a>
        <a class="quiz-btn" href="/quiz/264.html">VERA/PAUL</a>
        <a class="quiz-btn" href="/quiz/266.html">THOMAS/ANNA</a>
        <a class="quiz-btn" href="/quiz/268.html">JENNIFER</a>
        <a class="quiz-btn" href="/quiz/269.html">TAMARA/JAKOB</a>
        <a class="quiz-btn" href="/quiz/273.html">ALEX & CORA</a>
        <a class="quiz-btn" href="/quiz/278.html">MIROSLAV</a>
        <a class="quiz-btn" href="/quiz/280.html">KARLA</a>
        <a class="quiz-btn" href="/quiz/282.html">MORITZ</a>
        <a class="quiz-btn" href="/quiz/283.html">ALICIA</a>
      </div>
    </div>

    <!-- Sprachbausteine Teil 2 -->
    <div class="section-card">
      <div class="section-title">
        <i class="fas fa-shapes" style="color: var(--primary-color);"></i>
        Sprachbausteine Teil 2
      </div>
      <div class="quiz-grid">
        <a class="quiz-btn" href="/quiz/210.html">PETRA/ALICIA</a>
        <a class="quiz-btn" href="/quiz/212.html">EVA</a>
        <a class="quiz-btn" href="/quiz/214.html">IRIS</a>
        <a class="quiz-btn" href="/quiz/253.html">SOPHIE</a>
        <a class="quiz-btn" href="/quiz/252.html">NICOLE</a>
        <a class="quiz-btn" href="/quiz/255.html">NADJA/CLAUDIA</a>
        <a class="quiz-btn" href="/quiz/256.html">ANDREAS</a>
        <a class="quiz-btn" href="/quiz/258.html">ANDREAS2/JAN</a>
        <a class="quiz-btn" href="/quiz/260.html">ANNIKA1&2</a>
        <a class="quiz-btn" href="/quiz/263.html">CAROLINA/CORINA</a>
        <a class="quiz-btn" href="/quiz/265.html">VERA</a>
        <a class="quiz-btn" href="/quiz/267.html">THOMAS/ANNA<br>JENNIFER</a>
        <a class="quiz-btn" href="/quiz/270.html">TAMARA/JAKOB<br>SONJA</a>
        <a class="quiz-btn" href="/quiz/272.html">VIKTOR</a>
        <a class="quiz-btn" href="/quiz/274.html">ALEX & CORA</a>
        <a class="quiz-btn" href="/quiz/276.html">PAUL</a>
        <a class="quiz-btn" href="/quiz/277.html">RITA</a>
        <a class="quiz-btn" href="/quiz/279.html">MIROSLAV</a>
        <a class="quiz-btn" href="/quiz/281.html">KARLA/MORITZ</a>
        <a class="quiz-btn" href="/quiz/284.html">JAKOB2</a>
      </div>
    </div>
    </div>

    <!-- Hören -->
    <div id="tab-b1-hoeren" class="tab-content">
    <div class="section-card">
      <div class="section-title">
        <i class="fas fa-headphones" style="color: var(--secondary-color);"></i>
        Hören
      </div>
      <div class="quiz-grid">
        <a class="quiz-btn" href="/quiz/271.html">Teil 1</a>
        <a class="quiz-btn" href="/quiz/285.html">Teil 2</a>
        <a class="quiz-btn" href="/quiz/275.html">Teil 3</a>
      </div>
    </div>
    </div>
    <div id="tab-b1-schreiben" class="tab-content">
      <div class="section-card">
        <div class="section-title">
          <i class="fas fa-pen-nib" style="color: var(--primary-color);"></i>
          Aufgabe 1 – Formeller Brief
        </div>
        <div style="display: grid; gap: 16px;">
          <div style="color: var(--text-light); font-weight: 600;">Schreiben Sie einen formellen Brief.</div>
          <div style="background: var(--light-color); border-radius: 12px; padding: 14px; color: var(--text-color);">Thema: Sie haben ein Produkt gekauft, das nicht wie beschrieben funktioniert. Bitten Sie um Lösung oder Rückerstattung.</div>
          <textarea id="write1B1" style="width: 100%; min-height: 220px; border-radius: 12px; padding: 14px; font-size: 1rem;"></textarea>
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <div id="write1CountB1" style="font-weight:700; color: var(--text-light);">0 Wörter</div>
            <div style="display:flex; gap:8px;">
              <button id="write1B1Save" class="btn btn-secondary" style="padding:8px 16px;">Speichern</button>
              <button id="write1B1Copy" class="btn" style="padding:8px 16px;">Kopieren</button>
              <button id="write1B1Clear" class="btn btn-danger" style="padding:8px 16px;">Leeren</button>
            </div>
          </div>
        </div>
      </div>
      <div class="section-card">
        <div class="section-title">
          <i class="fas fa-feather-pointed" style="color: var(--secondary-color);"></i>
          Aufgabe 2 – Stellungnahme
        </div>
        <div style="display: grid; gap: 16px;">
          <div style="color: var(--text-light); font-weight: 600;">Schreiben Sie eine Stellungnahme.</div>
          <div style="background: var(--light-color); border-radius: 12px; padding: 14px; color: var(--text-color);">Thema: Sollten Hausaufgaben in der Schule reduziert werden? Begründen Sie Ihre Meinung.</div>
          <textarea id="write2B1" style="width: 100%; min-height: 220px; border-radius: 12px; padding: 14px; font-size: 1rem;"></textarea>
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <div id="write2CountB1" style="font-weight:700; color: var(--text-light);">0 Wörter</div>
            <div style="display:flex; gap:8px;">
              <button id="write2B1Save" class="btn btn-secondary" style="padding:8px 16px;">Speichern</button>
              <button id="write2B1Copy" class="btn" style="padding:8px 16px;">Kopieren</button>
              <button id="write2B1Clear" class="btn btn-danger" style="padding:8px 16px;">Leeren</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Warning Box -->
  <div id="warningBox">
    Inaktivität erkannt! Automatische Abmeldung in <span id="countdown">30</span> Sekunden.
  </div>

  <!-- Footer -->
  <footer class="footer">
    <p style="opacity: 0.6;">&copy; 2026 German Quiz Master</p>
  </footer>

  <script src="js/auth.js"></script>
  <script>
    // Logout function using Auth.js or direct fetch if Auth.js isn't fully integrated here yet
    // But since we are redesigning, let's use the existing logic but cleaner.

    function logout() {
      fetch("/logout", { method: "POST" })
        .then(() => window.location.href = "/");
    }

    let pingTimeout;
    let logoutTimer;
    let warningTimer;
    let countdownTimer;
    let lastPing = 0;

    const INACTIVITY_LIMIT = 15 * 60 * 1000; // 15 minutes
    const WARNING_BEFORE_LOGOUT = 30 * 1000; // 30 seconds
    const warningBox = document.getElementById("warningBox");
    const countdownEl = document.getElementById("countdown");

    function sendPing() {
      const now = Date.now();
      if (now - lastPing < 10000) return;
      lastPing = now;
      fetch("/ping").catch(() => { });
    }

    function resetTimers() {
      clearTimeout(pingTimeout);
      clearTimeout(logoutTimer);
      clearTimeout(warningTimer);
      clearInterval(countdownTimer);

      warningBox.style.display = "none";

      sendPing();
      pingTimeout = setTimeout(sendPing, 60 * 1000);

      // Show warning 30s before logout
      warningTimer = setTimeout(() => {
        let remaining = 30;
        warningBox.style.display = "block";
        countdownEl.textContent = remaining;

        countdownTimer = setInterval(() => {
          remaining--;
          countdownEl.textContent = remaining;
          if (remaining <= 0) {
            clearInterval(countdownTimer);
          }
        }, 1000);
      }, INACTIVITY_LIMIT - WARNING_BEFORE_LOGOUT);

      // Auto logout
      logoutTimer = setTimeout(() => {
        logout();
      }, INACTIVITY_LIMIT);
    }

    // Events
    ["mousemove", "keydown", "scroll", "click", "touchstart"].forEach(evt => {
      document.addEventListener(evt, resetTimers);
    });

    window.addEventListener("pageshow", sendPing);
    window.addEventListener("beforeunload", sendPing);

    resetTimers();
    document.addEventListener('DOMContentLoaded', function () {
      var tabs = document.querySelectorAll('.tabs .tab');
      var panels = document.querySelectorAll('.tab-content');
      tabs.forEach(function(tab){
        tab.addEventListener('click', function(){
          var id = tab.getAttribute('data-target');
          panels.forEach(function(p){ p.classList.toggle('active', p.id === id); });
          tabs.forEach(function(t){ t.classList.toggle('active', t === tab); });
        });
      });
      var lesen = document.getElementById('tab-b1-lesen');
      if (lesen) {
        var subTabs = lesen.querySelectorAll('.sub-tab');
        var subs = lesen.querySelectorAll('.sub-content');
        subTabs.forEach(function(st){
          st.addEventListener('click', function(){
            var id = st.getAttribute('data-target');
            subs.forEach(function(c){ c.classList.toggle('active', c.id === id); });
            subTabs.forEach(function(s){ s.classList.toggle('active', s === st); });
          });
        });
        
      }
      var heroSearch = document.getElementById('heroSearchB1');
      if (heroSearch) {
        heroSearch.addEventListener('input', function(){
          var q = heroSearch.value.toLowerCase();
          var activeTab = document.querySelector('.tab-content.active');
          if (!activeTab) return;
          var scope = activeTab.querySelector('.sub-content.active') || activeTab;
          scope.querySelectorAll('.quiz-btn').forEach(function(btn){
            var t = btn.textContent.toLowerCase();
            btn.style.display = t.indexOf(q) !== -1 ? '' : 'none';
          });
        });
      }
      function updateCount(id, counterId, storageKey) {
        var ta = document.getElementById(id);
        var counter = document.getElementById(counterId);
        if (!ta || !counter) return;
        var saved = localStorage.getItem(storageKey);
        if (saved) { ta.value = saved; }
        var calc = function(){
          var text = ta.value.trim();
          var count = text ? text.split(/\s+/).filter(Boolean).length : 0;
          counter.textContent = count + ' Wörter';
          localStorage.setItem(storageKey, ta.value);
        };
        ta.addEventListener('input', calc);
        calc();
        var saveBtn = document.getElementById(id + 'Save');
        var copyBtn = document.getElementById(id + 'Copy');
        var clearBtn = document.getElementById(id + 'Clear');
        if (saveBtn) saveBtn.addEventListener('click', function(){ localStorage.setItem(storageKey, ta.value); });
        if (copyBtn) copyBtn.addEventListener('click', function(){ navigator.clipboard.writeText(ta.value); });
        if (clearBtn) clearBtn.addEventListener('click', function(){ ta.value=''; calc(); });
      }
      updateCount('write1B1','write1CountB1','b1_write1');
      updateCount('write2B1','write2CountB1','b1_write2');
    });
    (async function () {
      var menu = document.getElementById('menuCard');
      var user = await Auth.getCurrentUser();
      if (!menu) return;
      if (user) {
        menu.innerHTML = '<div class="menu-header"><span>Menü</span><span>'+(user.name||'Benutzer')+'</span></div>'
          + '<div class="menu-row">'
          + '<button id="theme-toggle" class="menu-item" style="padding: 10px 14px;"></button>'
          + '<button onclick="Auth.logout()" class="menu-item primary">Abmelden</button>'
          + '</div>';
      } else {
        menu.innerHTML = '<div class="menu-header"><span>Menü</span><span>Gast</span></div>'
          + '<div class="menu-row">'
          + '<a href="login.html" class="menu-item primary">Anmelden</a>'
          + '<a href="register.html" class="menu-item">Registrieren</a>'
          + '</div>'
          + '<div class="menu-row">'
          + '<button id="theme-toggle" class="menu-item" style="padding: 10px 14px;"></button>'
          + '</div>';
      }
      if (document.getElementById('theme-toggle')) {
        updateThemeToggleIcon();
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
      }
    })();
    (function () {
      var trigger = document.getElementById('menuTrigger');
      var card = document.getElementById('menuCard');
      function toggleMenu() {
        if (!card) return;
        var show = !(card.style.display === 'block');
        card.style.display = show ? 'block' : 'none';
        card.classList.toggle('open', show);
      }
      function closeMenu(e) {
        if (!card) return;
        var within = card.contains(e.target) || trigger.contains(e.target);
        if (!within) { card.style.display = 'none'; card.classList.remove('open'); }
      }
      if (trigger) trigger.addEventListener('click', toggleMenu);
      document.addEventListener('click', closeMenu);
    })();
  </script>
</body>

</html>
